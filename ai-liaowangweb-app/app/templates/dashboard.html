<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <meta charset='UTF-8'/>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'/>
    <title>AI智能政企望舆情数据采集与分析系统</title>
    <script src='https://cdn.tailwindcss.com'></script>
    <link href='https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css' rel='stylesheet'/>
    <script src='https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js'></script>
    <script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: '#165DFF',
        secondary: '#0FC6C2',
        accent: '#722ED1',
        dark: '#1D2129',
        'dark-light': '#272E3B',
        'gray-custom': '#86909C',
        'light-gray': '#F2F3F5'
      },
      fontFamily: {
        inter: ['Inter', 'sans-serif']
      },
      spacing: {
        '18': '4.5rem',
        '22': '5.5rem'
      },
      boxShadow: {
        'glow': '0 0 15px rgba(22, 93, 255, 0.5)',
        'glow-lg': '0 0 25px rgba(22, 93, 255, 0.7)'
      }
    }
  }
};

// Smooth scrolling for anchor links
document.addEventListener('DOMContentLoaded', function() {
  // Check if URL has hash for collection management
  if (window.location.hash === '#collection-management') {
    const element = document.getElementById('collection-management');
    if (element) {
      element.scrollIntoView({ behavior: 'smooth' });
    }
  }
  
  // Add smooth scrolling to sidebar links
  const sidebarLinks = document.querySelectorAll('.sidebar-item');
  sidebarLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href.includes('#collection-management')) {
        e.preventDefault();
        const element = document.getElementById('collection-management');
        if (element) {
          element.scrollIntoView({ behavior: 'smooth' });
        }
      }
    });
  });
});
</script>
<style type='text/tailwindcss'>
    @layer utilities {
        .content-auto {
            content-visibility: auto;
        }
        .text-shadow {
            text-shadow: 0 0 8px rgba(22, 93, 255, 0.5);
        }
        .bg-grid {
            background-image: radial-gradient(rgba(22, 93, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
        }
        .sidebar-item {
            @apply flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-300;
        }
        .sidebar-item.active {
            @apply bg-primary/10 text-primary font-medium;
        }
        .sidebar-item:not(.active):hover {
            @apply bg-dark-light;
        }
        .stat-card {
            @apply bg-dark-light rounded-xl p-5 card-hover border border-primary/20;
        }
        .stat-value {
            @apply text-3xl md:text-4xl font-bold text-white mt-2;
        }
        .stat-label {
            @apply text-gray-custom text-sm uppercase tracking-wider;
        }
        .stat-icon {
            @apply w-10 h-10 rounded-lg flex items-center justify-center;
        }
        .status-indicator {
            @apply w-3 h-3 rounded-full inline-block mr-2;
        }
        .status-online {
            @apply bg-green-500 animate-pulse;
        }
        .status-offline {
            @apply bg-red-500;
        }
        .status-warning {
            @apply bg-yellow-500;
        }
    }
</style>
</head>
<body class='bg-dark text-white font-inter min-h-screen flex flex-col'>
    <!-- [MODULE] a1b_主内容区域 -->
    <div class='flex flex-col md:flex-row h-screen overflow-hidden'>
        <!-- [MODULE] c3d_侧边导航栏 -->
        <aside id='sidebar' class='bg-dark-light w-full md:w-64 flex-shrink-0 transition-all duration-300 z-20 md:translate-x-0 transform -translate-x-full md:static fixed md:relative h-full'>
            <div class='flex items-center justify-between p-4 border-b border-primary/20'>
                <div class='flex items-center gap-3'>
                    <div class='w-10 h-10 rounded-lg bg-primary flex items-center justify-center'>
                        <i class='fas fa-brain text-white text-xl'></i>
                    </div>
                    <h1 class='text-xl font-bold text-white hidden md:block'>
                        AI政企瞭望
                    </h1>
                </div>
                <button id='close-sidebar' class='md:hidden text-gray-custom hover:text-white'>
                    <i class='fas fa-times'></i>
                </button>
            </div>
            <nav class='p-4 overflow-y-auto h-[calc(100%-64px)] scrollbar-hide'>
                <p class='text-xs uppercase text-gray-custom tracking-wider mb-3 px-4'>
                    主菜单
                </p>
                <a href='{{ url_for("main.dashboard") }}' class='sidebar-item active'>
                    <i class='fas fa-tachometer-alt w-5 text-center'></i>
                    <span>
                        后台主页
                    </span>
                </a>
                <a href='{{ url_for("main.dashboard") }}#collection-management' class='sidebar-item'>
                    <i class='fas fa-database w-5 text-center'></i>
                    <span>
                        采集管理
                    </span>
                </a>
                <a href='{{ url_for("crawler.list_crawlers") }}' class='sidebar-item'>
                    <i class='fas fa-spider w-5 text-center'></i>
                    <span>
                        爬虫管理
                    </span>
                </a>
                <a href='javascript:void(0);' class='sidebar-item'>
                    <i class='fas fa-table w-5 text-center'></i>
                    <span>
                        数据管理
                    </span>
                </a>
                <a href='javascript:void(0);' class='sidebar-item'>
                    <i class='fas fa-search-plus w-5 text-center'></i>
                    <span>
                        深采管理
                    </span>
                </a>
                <p class='text-xs uppercase text-gray-custom tracking-wider mb-3 mt-8 px-4'>
                    AI功能
                </p>
                <a href='{{ url_for("ai.ai_page") }}' class='sidebar-item'>
                    <i class='fas fa-cogs w-5 text-center'></i>
                    <span>
                        AI模型管理
                    </span>
                </a>
                <a href='javascript:void(0);' class='sidebar-item'>
                    <i class='fas fa-file-alt w-5 text-center'></i>
                    <span>
                        AI分析与报告
                    </span>
                </a>
                <a href='javascript:void(0);' class='sidebar-item'>
                    <i class='fas fa-chart-line w-5 text-center'></i>
                    <span>
                        AI数智大屏
                    </span>
                </a>
                <p class='text-xs uppercase text-gray-custom tracking-wider mb-3 mt-8 px-4'>
                    系统
                </p>
                <a href='javascript:void(0);' class='sidebar-item'>
                    <i class='fas fa-cog w-5 text-center'></i>
                    <span>
                        系统设置
                    </span>
                </a>
                <a href='javascript:void(0);' class='sidebar-item'>
                    <i class='fas fa-user-circle w-5 text-center'></i>
                    <span>
                        用户中心
                    </span>
                </a>
                <a href='{{ url_for("main.logout") }}' class='sidebar-item'>
                    <i class='fas fa-sign-out-alt w-5 text-center'></i>
                    <span>
                        退出登录
                    </span>
                </a>
            </nav>
        </aside>
        <!-- [/MODULE] c3d_侧边导航栏 -- 包含系统所有功能模块的导航链接，在移动端可折叠 -->
        <!-- [MODULE] e5f_主内容区域 -->
        <div class='flex-1 flex flex-col overflow-hidden'>
            <!-- [MODULE] g7h_顶部导航栏 -->
            <header class='bg-dark-light border-b border-primary/20 h-16 flex items-center justify-between px-4 md:px-6 z-10'>
                <div class='flex items-center gap-4'>
                    <button id='toggle-sidebar' class='md:hidden text-gray-custom hover:text-white'>
                        <i class='fas fa-bars'></i>
                    </button>
                    <div class='relative hidden md:block'>
                        <input type='text' placeholder='搜索...' class='bg-dark rounded-lg py-2 pl-10 pr-4 text-sm w-64 focus:outline-none focus:ring-2 focus:ring-primary/50'/>
                        <i class='fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-custom'></i>
                    </div>
                </div>
                <div class='flex items-center gap-4'>
                    <button class='relative text-gray-custom hover:text-white'>
                        <i class='fas fa-bell text-xl'></i>
                        <span class='absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-white text-xs flex items-center justify-center'>
                            3
                        </span>
                    </button>
                    <div class='flex items-center gap-3'>
                        <img src='https://design.gemcoder.com/staticResource/echoAiSystemImages/54a1fb7390ddbe8fc2354c0ff6abec22.png' alt='用户头像' class='w-8 h-8 rounded-full object-cover border-2 border-primary/50'/>
                        <div class='hidden md:block'>
                            <p class='text-sm font-medium'>
                                {{ current_user.username }}
                            </p>
                            <p class='text-xs text-gray-custom'>
                                系统管理员
                            </p>
                        </div>
                    </div>
                </div>
            </header>
            <!-- [/MODULE] g7h_顶部导航栏 -- 包含侧边栏切换按钮、搜索框、通知图标和用户信息 -->
            <!-- [MODULE] i9j_后台主页 -->
            <main class='flex-1 overflow-y-auto bg-grid p-4 md:p-6'>
                <!-- [MODULE] k0l_后台主页:页面标题 -->
                <div class='mb-8'>
                    <h2 class='text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-white text-shadow'>
                        系统概览
                    </h2>
                    <p class='text-gray-custom mt-1'>
                        实时监控系统运行状态和数据统计
                    </p>
                </div>
                <!-- [/MODULE] k0l_后台主页:页面标题 -- 包含页面标题和描述文字 -->
                <!-- [MODULE] m2n_后台主页:数据统计卡片 -->
                <div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8'>
                    <!-- 总数据量卡片 -->
                    <div class='stat-card'>
                        <div class='flex justify-between items-start'>
                            <div>
                                <p class='stat-label'>
                                    总数据量
                                </p>
                                <p class='stat-value'>
                                    128.5万
                                </p>
                                <p class='text-green-500 text-sm mt-1 flex items-center'>
                                    <i class='fas fa-arrow-up mr-1'></i>
                                    12.5%
                                    <span class='text-gray-custom ml-1'>
                                        较上月
                                    </span>
                                </p>
                            </div>
                            <div class='stat-icon bg-primary/20 text-primary'>
                                <i class='fas fa-database text-xl'></i>
                            </div>
                        </div>
                    </div>
                    <!-- 总爬虫量卡片 -->
                    <div class='stat-card'>
                        <div class='flex justify-between items-start'>
                            <div>
                                <p class='stat-label'>
                                    总爬虫量
                                </p>
                                <p class='stat-value'>
                                    32
                                </p>
                                <p class='text-green-500 text-sm mt-1 flex items-center'>
                                    <i class='fas fa-arrow-up mr-1'></i>
                                    3
                                    <span class='text-gray-custom ml-1'>
                                        新增
                                    </span>
                                </p>
                            </div>
                            <div class='stat-icon bg-secondary/20 text-secondary'>
                                <i class='fas fa-spider text-xl'></i>
                            </div>
                        </div>
                    </div>
                    <!-- AI引擎状态卡片 -->
                    <div class='stat-card'>
                        <div class='flex justify-between items-start'>
                            <div>
                                <p class='stat-label'>
                                    AI引擎状态
                                </p>
                                <p class='stat-value flex items-center'>
                                    <span class='status-indicator status-online'></span>
                                    运行中
                                </p>
                                <p class='text-gray-custom text-sm mt-1'>
                                    负载: 68%
                                </p>
                            </div>
                            <div class='stat-icon bg-accent/20 text-accent'>
                                <i class='fas fa-brain text-xl'></i>
                            </div>
                        </div>
                    </div>
                    <!-- 系统状态卡片 -->
                    <div class='stat-card'>
                        <div class='flex justify-between items-start'>
                            <div>
                                <p class='stat-label'>
                                    系统状态
                                </p>
                                <p class='stat-value flex items-center'>
                                    <span class='status-indicator status-online'></span>
                                    正常
                                </p>
                                <p class='text-gray-custom text-sm mt-1'>
                                    运行时间: 128天
                                </p>
                            </div>
                            <div class='stat-icon bg-green-500/20 text-green-500'>
                                <i class='fas fa-server text-xl'></i>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- [/MODULE] m2n_后台主页:数据统计卡片 -- 包含总数据量、总爬虫量、AI引擎状态和系统状态四个统计卡片，每个卡片显示相应数据和趋势 -->
                <!-- [MODULE] p3q_后台主页:图表区域 -->
                <div class='grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8'>
                    <!-- 数据增长趋势图 -->
                    <div class='lg:col-span-2 bg-dark-light rounded-xl p-5 border border-primary/20'>
                        <div class='flex justify-between items-center mb-6'>
                            <h3 class='font-semibold text-lg'>
                                数据增长趋势
                            </h3>
                            <div class='flex gap-2'>
                                <button class='px-3 py-1 text-xs bg-primary/10 text-primary rounded-lg'>
                                    日
                                </button>
                                <button class='px-3 py-1 text-xs bg-dark rounded-lg text-gray-custom'>
                                    周
                                </button>
                                <button class='px-3 py-1 text-xs bg-dark rounded-lg text-gray-custom'>
                                    月
                                </button>
                            </div>
                        </div>
                        <div id='data-trend-chart' class='w-full h-80'></div>
                    </div>
                    <!-- 数据来源分布 -->
                    <div class='bg-dark-light rounded-xl p-5 border border-primary/20'>
                        <h3 class='font-semibold text-lg mb-6'>
                            数据来源分布
                        </h3>
                        <div id='data-source-chart' class='w-full h-80'></div>
                    </div>
                </div>
                <!-- [/MODULE] p3q_后台主页:图表区域 -- 包含数据增长趋势图和数据来源分布图两个图表，展示系统数据的变化趋势和来源分布情况 -->
                <!-- [MODULE] r4s_后台主页:系统状态和任务列表 -->
                <div class='grid grid-cols-1 lg:grid-cols-3 gap-6'>
                    <!-- 系统资源状态 -->
                    <div class='bg-dark-light rounded-xl p-5 border border-primary/20'>
                        <h3 class='font-semibold text-lg mb-4'>
                            系统资源状态
                        </h3>
                        <div class='space-y-6'>
                            <div>
                                <div class='flex justify-between mb-2'>
                                    <span class='text-sm text-gray-custom'>
                                        CPU 使用率
                                    </span>
                                    <span class='text-sm font-medium'>
                                        42%
                                    </span>
                                </div>
                                <div class='w-full bg-dark rounded-full h-2'>
                                    <div class='bg-primary h-2 rounded-full' style='width: 42%'></div>
                                </div>
                            </div>
                            <div>
                                <div class='flex justify-between mb-2'>
                                    <span class='text-sm text-gray-custom'>
                                        内存 使用率
                                    </span>
                                    <span class='text-sm font-medium'>
                                        68%
                                    </span>
                                </div>
                                <div class='w-full bg-dark rounded-full h-2'>
                                    <div class='bg-secondary h-2 rounded-full' style='width: 68%'></div>
                                </div>
                            </div>
                            <div>
                                <div class='flex justify-between mb-2'>
                                    <span class='text-sm text-gray-custom'>
                                        磁盘 使用率
                                    </span>
                                    <span class='text-sm font-medium'>
                                        35%
                                    </span>
                                </div>
                                <div class='w-full bg-dark rounded-full h-2'>
                                    <div class='bg-accent h-2 rounded-full' style='width: 35%'></div>
                                </div>
                            </div>
                            <div>
                                <div class='flex justify-between mb-2'>
                                    <span class='text-sm text-gray-custom'>
                                        网络 流量
                                    </span>
                                    <span class='text-sm font-medium'>
                                        1.2 GB/s
                                    </span>
                                </div>
                                <div class='w-full bg-dark rounded-full h-2'>
                                    <div class='bg-green-500 h-2 rounded-full' style='width: 55%'></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 爬虫任务状态 -->
                    <div class='lg:col-span-2 bg-dark-light rounded-xl p-5 border border-primary/20'>
                        <div class='flex justify-between items-center mb-4'>
                            <h3 class='font-semibold text-lg'>
                                爬虫任务状态
                            </h3>
                            <button class='text-primary text-sm flex items-center'>
                                <i class='fas fa-plus mr-1'></i>
                                新建任务
                            </button>
                        </div>
                        <div class='overflow-x-auto'>
                            <table class='w-full text-sm'>
                                <thead>
                                    <tr class='border-b border-primary/20'>
                                        <th class='text-left py-3 px-2 text-gray-custom'>
                                            任务名称
                                        </th>
                                        <th class='text-left py-3 px-2 text-gray-custom'>
                                            状态
                                        </th>
                                        <th class='text-left py-3 px-2 text-gray-custom'>
                                            进度
                                        </th>
                                        <th class='text-left py-3 px-2 text-gray-custom'>
                                            数据量
                                        </th>
                                        <th class='text-left py-3 px-2 text-gray-custom'>
                                            操作
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class='border-b border-dark'>
                                        <td class='py-3 px-2'>
                                            微博舆情采集
                                        </td>
                                        <td class='py-3 px-2'>
                                            <span class='px-2 py-1 bg-green-500/20 text-green-500 rounded-full text-xs flex items-center'>
                                                <span class='status-indicator status-online w-2 h-2'></span>
                                                运行中
                                            </span>
                                        </td>
                                        <td class='py-3 px-2'>
                                            <div class='w-full bg-dark rounded-full h-1.5'>
                                                <div class='bg-primary h-1.5 rounded-full' style='width: 75%'></div>
                                            </div>
                                            <span class='text-xs text-gray-custom mt-1 block'>
                                                75%
                                            </span>
                                        </td>
                                        <td class='py-3 px-2'>
                                            45,892
                                        </td>
                                        <td class='py-3 px-2'>
                                            <div class='flex gap-2'>
                                                <button class='text-primary hover:text-primary/80'>
                                                    <i class='fas fa-pause'></i>
                                                </button>
                                                <button class='text-gray-custom hover:text-white'>
                                                    <i class='fas fa-edit'></i>
                                                </button>
                                                <button class='text-gray-custom hover:text-white'>
                                                    <i class='fas fa-trash'></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class='border-b border-dark'>
                                        <td class='py-3 px-2'>
                                            新闻网站监控
                                        </td>
                                        <td class='py-3 px-2'>
                                            <span class='px-2 py-1 bg-blue-500/20 text-blue-500 rounded-full text-xs flex items-center'>
                                                <span class='status-indicator status-warning w-2 h-2'></span>
                                                暂停中
                                            </span>
                                        </td>
                                        <td class='py-3 px-2'>
                                            <div class='w-full bg-dark rounded-full h-1.5'>
                                                <div class='bg-primary h-1.5 rounded-full' style='width: 45%'></div>
                                            </div>
                                            <span class='text-xs text-gray-custom mt-1 block'>
                                                45%
                                            </span>
                                        </td>
                                        <td class='py-3 px-2'>
                                            12,345
                                        </td>
                                        <td class='py-3 px-2'>
                                            <div class='flex gap-2'>
                                                <button class='text-primary hover:text-primary/80'>
                                                    <i class='fas fa-play'></i>
                                                </button>
                                                <button class='text-gray-custom hover:text-white'>
                                                    <i class='fas fa-edit'></i>
                                                </button>
                                                <button class='text-gray-custom hover:text-white'>
                                                    <i class='fas fa-trash'></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class='border-b border-dark'>
                                        <td class='py-3 px-2'>
                                            论坛数据采集
                                        </td>
                                        <td class='py-3 px-2'>
                                            <span class='px-2 py-1 bg-red-500/20 text-red-500 rounded-full text-xs flex items-center'>
                                                <span class='status-indicator status-offline w-2 h-2'></span>
                                                已停止
                                            </span>
                                        </td>
                                        <td class='py-3 px-2'>
                                            <div class='w-full bg-dark rounded-full h-1.5'>
                                                <div class='bg-primary h-1.5 rounded-full' style='width: 100%'></div>
                                            </div>
                                            <span class='text-xs text-gray-custom mt-1 block'>
                                                100%
                                            </span>
                                        </td>
                                        <td class='py-3 px-2'>
                                            89,765
                                        </td>
                                        <td class='py-3 px-2'>
                                            <div class='flex gap-2'>
                                                <button class='text-primary hover:text-primary/80'>
                                                    <i class='fas fa-play'></i>
                                                </button>
                                                <button class='text-gray-custom hover:text-white'>
                                                    <i class='fas fa-edit'></i>
                                                </button>
                                                <button class='text-gray-custom hover:text-white'>
                                                    <i class='fas fa-trash'></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- [/MODULE] r4s_后台主页:系统状态和任务列表 -- 包含系统资源状态和爬虫任务状态两个模块，分别显示系统资源使用情况和爬虫任务的详细信息 -->
                
                <!-- [MODULE] 采集管理模块 -->
                <div class="mt-8" id="collection-management">
                    <!-- 页面标题 -->
                    <div class="mb-8">
                        <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white text-shadow">
                            数据采集管理
                        </h2>
                        <p class="text-gray-custom mt-1">
                            输入关键字，选择爬虫源，开始定向采集数据
                        </p>
                    </div>
                    
                    <!-- 关键字输入区 -->
                    <div class="mb-8 bg-dark-light rounded-xl p-6 border border-primary/20">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="flex-1 relative">
                                <label class="block text-sm font-medium text-white mb-1" for="keyword">
                                    采集关键字
                                </label>
                                <div class="relative">
                                    <input class="w-full px-4 py-3 pl-10 pr-40 rounded-lg border border-primary/20 bg-dark text-white focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none transition-all duration-300 placeholder:text-gray-custom" id="keyword" name="keyword" placeholder="请输入需要采集的关键字..." required>
                                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-custom">
                                    </i>
                                </div>
                            </div>
                            <div class="flex items-end gap-3">
                                <button type="submit" class="bg-primary text-white px-4 py-2 rounded-lg transition-all duration-300 hover:bg-primary/90 active:scale-100 shadow-md hover:shadow-lg flex items-center gap-2" id="start-collection">
                                    <i class="fas fa-play">
                                    </i>
                                    <span>
                                        开始采集
                                    </span>
                                </button>
                                <button class="bg-dark-light text-white border border-primary/20 px-4 py-2 rounded-lg transition-all duration-300 hover:bg-dark active:scale-100 flex items-center gap-2" disabled="" id="stop-collection">
                                    <i class="fas fa-stop">
                                    </i>
                                    <span>
                                        停止采集
                                    </span>
                                </button>
                            </div>
                        </div>
                        <div class="hidden mt-2 text-red-500 text-sm flex items-center gap-1" id="keyword-error">
                            <i class="fas fa-exclamation-circle">
                            </i>
                            <span>
                                请输入有效的关键字
                            </span>
                        </div>
                    </div>
                    
                    <!-- 爬虫源选择开关面板 -->
                    <div class="mb-8 bg-dark-light rounded-xl p-6 border border-primary/20">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-white">
                            <i class="fas fa-cogs text-primary">
                            </i>
                            <span>
                                爬虫源选择
                            </span>
                        </h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="crawler-sources">
                            {% if crawlers %}
                                {% for crawler in crawlers %}
                                    <div class="flex items-center justify-between p-3 border border-primary/20 rounded-lg hover:bg-dark transition-colors">
                                        <div>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <div class="relative inline-block w-10 h-5 mr-2 align-middle select-none transition duration-300 ease-in-out">
                                                    <input type="checkbox" id="crawler-{{ crawler.id }}" name="crawler_ids" value="{{ crawler.id }}" class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-4 appearance-none cursor-pointer checked:right-0 checked:border-primary" checked>
                                                    <label for="crawler-{{ crawler.id }}" class="toggle-label block overflow-hidden h-5 rounded-full bg-primary/20 cursor-pointer transition-all duration-300"></label>
                                                </div>
                                                <span class="font-medium">{{ crawler.name }}</span>
                                            </label>
                                            <p class="text-xs text-gray-custom mt-0.5">{{ crawler.description or crawler.type }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="col-span-full text-center py-4 text-gray-custom">
                                    <p>暂无可用的爬虫源，请先在爬虫管理中添加并激活爬虫</p>
                                </div>
                            {% endif %}
                        </div>
                        {% if crawlers %}
                            <div class="mt-4 flex justify-between">
                                <button class="text-sm text-primary hover:text-primary/80 transition-colors flex items-center gap-1" id="select-all">
                                    <i class="fas fa-check-square">
                                    </i>
                                    <span>
                                        全选
                                    </span>
                                </button>
                                <button class="text-sm text-gray-custom hover:text-white transition-colors flex items-center gap-1" id="deselect-all">
                                    <i class="fas fa-square">
                                    </i>
                                    <span>
                                        取消全选
                                    </span>
                                </button>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- 采集状态显示区 -->
                    <div class="mb-6 hidden" id="collection-status">
                        <div class="flex items-center justify-between bg-primary/20 border border-primary/30 rounded-lg p-4">
                            <div class="flex items-center gap-3">
                                <div class="w-3 h-3 rounded-full bg-primary animate-pulse">
                                </div>
                                <span class="font-medium">
                                    正在采集数据...
                                </span>
                            </div>
                            <div class="text-sm text-gray-custom">
                                <span id="collected-count">
                                    已采集: 0
                                </span>
                                |
                                <span id="selected-count">
                                    已选择: 0
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 数据操作区 -->
                    <div class="mb-6 hidden" id="data-actions">
                        <div class="flex justify-between items-center">
                            <button class="bg-primary text-white px-4 py-2 rounded-lg transition-all duration-300 hover:bg-primary/90 active:scale-100 shadow-md hover:shadow-lg flex items-center gap-2" id="save-selected">
                                <i class="fas fa-save">
                                </i>
                                <span>
                                    保存选中数据
                                </span>
                            </button>
                            <div class="flex gap-2">
                                <button class="bg-dark-light text-white border border-primary/20 px-4 py-2 rounded-lg transition-all duration-300 hover:bg-dark active:scale-100 text-sm" id="select-visible">
                                    <i class="fas fa-check">
                                    </i>
                                    选择可见
                                </button>
                                <button class="bg-dark-light text-white border border-primary/20 px-4 py-2 rounded-lg transition-all duration-300 hover:bg-dark active:scale-100 text-sm" id="clear-selected">
                                    <i class="fas fa-times">
                                    </i>
                                    清除选择
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 橱窗数据列表 -->
                    <div class="mt-8" id="collection-results">
                        <div class="py-20 text-center" id="empty-state">
                            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-dark-light mb-4">
                                <i class="fas fa-search text-2xl text-gray-custom">
                                </i>
                            </div>
                            <h3 class="text-lg font-medium text-white mb-1">
                                暂无采集数据
                            </h3>
                            <p class="text-gray-custom max-w-md mx-auto">
                                输入关键字，选择爬虫源，点击"开始采集"按钮开始采集数据
                            </p>
                        </div>
                        <div class="py-20 text-center hidden" id="loading-state">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4">
                            </div>
                            <h3 class="text-lg font-medium text-white">
                                正在准备采集...
                            </h3>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 hidden" id="results-grid">
                            <!-- 采集结果将通过JS动态生成 -->
                        </div>
                    </div>
                </div>
                <!-- [/MODULE] 采集管理模块 -->
            </main>
            <!-- [/MODULE] i9j_后台主页 -- 后台主页内容，包含系统概览、数据统计、图表显示和任务状态等模块 -->
        </div>
        <!-- [/MODULE] e5f_主内容区域 -- 主内容区域，包含顶部导航栏和后台主页内容 -->
    </div>
    <!-- [/MODULE] a1b_主内容区域 -- 整个页面的主内容区域，包含侧边导航栏和主内容区域 -->
    
    <!-- 保存成功提示弹窗 -->
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" id="save-success-modal">
        <div class="bg-dark-light rounded-xl p-6 max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-2xl text-green-500">
                    </i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">
                    保存成功
                </h3>
                <p class="text-gray-custom mb-6" id="save-success-message">
                    已成功保存选中的数据到数据库
                </p>
                <button class="bg-primary text-white px-4 py-2 rounded-lg transition-all duration-300 hover:bg-primary/90 active:scale-100 shadow-md hover:shadow-lg w-full" id="close-modal">
                    <i class="fas fa-check-circle">
                    </i>
                    确认
                </button>
            </div>
        </div>
    </div>
    <!-- [JSMOD] j0k_侧边栏交互 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 侧边栏切换
    const toggleSidebar = document.getElementById('toggle-sidebar');
    const closeSidebar = document.getElementById('close-sidebar');
    const sidebar = document.getElementById('sidebar');

    toggleSidebar.addEventListener('click', function() {
        sidebar.classList.remove('-translate-x-full');
    });

    closeSidebar.addEventListener('click', function() {
        sidebar.classList.add('-translate-x-full');
    });

    // 数据增长趋势图
    const dataTrendChart = echarts.init(document.getElementById('data-trend-chart'));
    const dataTrendOption = {
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data: ['数据量'],
            textStyle: {
                color: '#86909C'
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
            axisLine: {
                lineStyle: {
                    color: '#272E3B'
                }
            },
            axisLabel: {
                color: '#86909C'
            }
        },
        yAxis: {
            type: 'value',
            axisLine: {
                lineStyle: {
                    color: '#272E3B'
                }
            },
            axisLabel: {
                color: '#86909C'
            },
            splitLine: {
                lineStyle: {
                    color: '#272E3B'
                }
            }
        },
        series: [
            {
                name: '数据量',
                type: 'line',
                stack: 'Total',
                data: [120, 132, 101, 134, 90, 230, 210, 250, 220, 280, 320, 350],
                lineStyle: {
                    color: '#165DFF'
                },
                areaStyle: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        {
                            offset: 0,
                            color: 'rgba(22, 93, 255, 0.3)'
                        },
                        {
                            offset: 1,
                            color: 'rgba(22, 93, 255, 0.05)'
                        }
                    ])
                }
            }
        ]
    };
    dataTrendChart.setOption(dataTrendOption);

    // 数据来源分布图
    const dataSourceChart = echarts.init(document.getElementById('data-source-chart'));
    const dataSourceOption = {
        tooltip: {
            trigger: 'item'
        },
        legend: {
            orient: 'vertical',
            left: 'left',
            textStyle: {
                color: '#86909C'
            }
        },
        series: [
            {
                name: '数据来源',
                type: 'pie',
                radius: '60%',
                data: [
                    { value: 35, name: '微博' },
                    { value: 25, name: '新闻网站' },
                    { value: 20, name: '论坛' },
                    { value: 15, name: '微信' },
                    { value: 5, name: '其他' }
                ],
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                },
                itemStyle: {
                    color: function(params) {
                        const colors = ['#165DFF', '#0FC6C2', '#722ED1', '#F7BA1E', '#F53F3F'];
                        return colors[params.dataIndex];
                    }
                }
            }
        ]
    };
    dataSourceChart.setOption(dataSourceOption);

    // 响应式处理
    window.addEventListener('resize', function() {
        dataTrendChart.resize();
        dataSourceChart.resize();
    });

    // 采集管理功能初始化
    initCollectionManagement();
});

// 采集管理功能
function initCollectionManagement() {
    // 全局变量
    let collectData = [];
    let isRunning = false;
    let lastScrollTop = 0;
    
    // 绑定开始采集按钮点击事件
    const startBtn = document.getElementById('start-collection');
    if (startBtn) {
        startBtn.addEventListener('click', function() {
            startCollect();
        });
    }
    
    // 绑定停止采集按钮点击事件
    const stopBtn = document.getElementById('stop-collection');
    if (stopBtn) {
        stopBtn.addEventListener('click', function() {
            stopCollect();
        });
    }
    
    // 绑定保存按钮点击事件
    const saveBtn = document.getElementById('save-selected');
    if (saveBtn) {
        saveBtn.addEventListener('click', function() {
            saveSelectedData();
        });
    }
    
    // 绑定全选按钮点击事件
    const selectAllBtn = document.getElementById('select-all');
    if (selectAllBtn) {
        selectAllBtn.addEventListener('click', function() {
            selectAllCrawlers(true);
        });
    }
    
    // 绑定取消全选按钮点击事件
    const deselectAllBtn = document.getElementById('deselect-all');
    if (deselectAllBtn) {
        deselectAllBtn.addEventListener('click', function() {
            selectAllCrawlers(false);
        });
    }
    
    // 绑定选择可见按钮点击事件
    const selectVisibleBtn = document.getElementById('select-visible');
    if (selectVisibleBtn) {
        selectVisibleBtn.addEventListener('click', function() {
            selectVisibleData();
        });
    }
    
    // 绑定清除选择按钮点击事件
    const clearSelectedBtn = document.getElementById('clear-selected');
    if (clearSelectedBtn) {
        clearSelectedBtn.addEventListener('click', function() {
            clearSelectedData();
        });
    }
    
    // 绑定关闭弹窗按钮点击事件
    const closeModalBtn = document.getElementById('close-modal');
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', function() {
            closeModal();
        });
    }
    
    // 初始化开关状态
    initToggleSwitches();
    
    // 定期获取采集数据和状态
    setInterval(function() {
        if (isRunning) {
            fetchCollectData();
        }
    }, 1000);

    // 初始化开关状态
    function initToggleSwitches() {
        const checkboxes = document.querySelectorAll('.toggle-checkbox');
        checkboxes.forEach(checkbox => {
            const label = checkbox.nextElementSibling;
            if (checkbox.checked) {
                label.classList.add('bg-primary');
                label.classList.remove('bg-primary/20');
            } else {
                label.classList.add('bg-primary/20');
                label.classList.remove('bg-primary');
            }
            
            // 绑定开关切换事件
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    label.classList.add('bg-primary');
                    label.classList.remove('bg-primary/20');
                } else {
                    label.classList.add('bg-primary/20');
                    label.classList.remove('bg-primary');
                }
            });
        });
    }
    
    // 全选/取消全选爬虫源
    function selectAllCrawlers(select) {
        const checkboxes = document.querySelectorAll('.toggle-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = select;
            const label = checkbox.nextElementSibling;
            if (select) {
                label.classList.add('bg-primary');
                label.classList.remove('bg-primary/20');
            } else {
                label.classList.add('bg-primary/20');
                label.classList.remove('bg-primary');
            }
        });
    }
    
    // 开始采集
    function startCollect() {
        const keyword = document.getElementById('keyword').value;
        const crawlerCheckboxes = document.querySelectorAll('input[name="crawler_ids"]:checked');
        const crawlerIds = Array.from(crawlerCheckboxes).map(cb => cb.value);
        
        // 验证输入
        if (!keyword) {
            const errorElement = document.getElementById('keyword-error');
            errorElement.classList.remove('hidden');
            return;
        } else {
            const errorElement = document.getElementById('keyword-error');
            errorElement.classList.add('hidden');
        }
        
        if (crawlerIds.length === 0) {
            alert('请选择至少一个爬虫源');
            return;
        }
        
        // 更新UI状态
        document.getElementById('start-collection').disabled = true;
        document.getElementById('stop-collection').disabled = false;
        document.getElementById('empty-state').classList.add('hidden');
        document.getElementById('loading-state').classList.remove('hidden');
        document.getElementById('collection-status').classList.remove('hidden');
        document.getElementById('collected-count').textContent = '已采集: 0';
        document.getElementById('selected-count').textContent = '已选择: 0';
        
        // 发送请求开始采集
        fetch('/crawler/collect/start', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'keyword': keyword,
                'crawler_ids': crawlerIds
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                isRunning = true;
                collectData = [];
                // 开始定期获取数据
                fetchCollectData();
            } else {
                alert(data.message);
                resetUIState();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('采集开始失败');
            resetUIState();
        });
    }
    
    // 停止采集
    function stopCollect() {
        isRunning = false;
        resetUIState();
        alert('采集已停止');
    }
    
    // 重置UI状态
    function resetUIState() {
        document.getElementById('start-collection').disabled = false;
        document.getElementById('stop-collection').disabled = true;
        document.getElementById('loading-state').classList.add('hidden');
        if (collectData.length === 0) {
            document.getElementById('empty-state').classList.remove('hidden');
            document.getElementById('collection-status').classList.add('hidden');
            document.getElementById('data-actions').classList.add('hidden');
        }
    }
    
    // 获取采集数据
    function fetchCollectData() {
        fetch('/crawler/collect/data')
        .then(response => response.json())
        .then(data => {
            const status = data.status;
            const newData = data.data;
            
            // 更新状态
            if (status.running) {
                document.getElementById('collected-count').textContent = `已采集: ${status.current || 0}`;
            } else {
                isRunning = false;
                document.getElementById('start-collection').disabled = false;
                document.getElementById('stop-collection').disabled = true;
                if (status.error) {
                    alert(`采集失败: ${status.error}`);
                } else {
                    document.getElementById('collected-count').textContent = `已采集: ${status.total || 0}`;
                }
            }
            
            // 更新数据列表
            if (newData.length > 0) {
                // 过滤重复数据
                const uniqueData = filterUniqueData(newData);
                collectData = uniqueData;
                renderCollectData(uniqueData);
                // 自动滚动到最新位置
                autoScrollToBottom();
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    
    // 过滤重复数据
    function filterUniqueData(data) {
        const seen = new Set();
        return data.filter(item => {
            const key = item.title + item.url;
            if (seen.has(key)) {
                return false;
            }
            seen.add(key);
            return true;
        });
    }
    
    // 渲染采集数据
    function renderCollectData(data) {
        const container = document.getElementById('results-grid');
        const emptyState = document.getElementById('empty-state');
        const loadingState = document.getElementById('loading-state');
        const dataActions = document.getElementById('data-actions');
        
        if (data.length === 0) {
            emptyState.classList.remove('hidden');
            loadingState.classList.add('hidden');
            container.classList.add('hidden');
            dataActions.classList.add('hidden');
            return;
        }
        
        // 显示结果网格
        emptyState.classList.add('hidden');
        loadingState.classList.add('hidden');
        container.classList.remove('hidden');
        dataActions.classList.remove('hidden');
        
        // 清空容器
        container.innerHTML = '';
        
        // 添加数据项
        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'bg-dark-light rounded-lg overflow-hidden border border-primary/20 card-hover';
            
            // 设置封面图片
            const coverImage = item.cover_image || 'https://design.gemcoder.com/api/searchImage?query=news%20article%20placeholder%20image&image_size=square';
            
            card.innerHTML = `
                <div class="relative h-48 overflow-hidden">
                    <img src="${coverImage}" alt="${item.title}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">
                    <div class="absolute top-3 right-3">
                        <input type="checkbox" id="data-${item.id}" value="${item.id}" class="w-5 h-5 rounded border-primary/20 text-primary focus:ring-primary">
                    </div>
                </div>
                <div class="p-4">
                    <h3 class="font-semibold mb-2 line-clamp-2">
                        <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="text-white hover:text-primary transition-colors">${item.title}</a>
                    </h3>
                    <p class="text-gray-custom text-sm mb-4 line-clamp-3">${item.abstract || ''}</p>
                    <div class="flex justify-between items-center text-xs text-gray-custom mb-3">
                        <span>${item.source || ''}</span>
                        <span>${item.timestamp || ''}</span>
                    </div>
                    <div class="mt-2">
                        <span class="text-xs text-white font-medium bg-primary bg-opacity-20 px-3 py-1 rounded-full">${item.keyword || ''}</span>
                    </div>
                </div>
            `;
            
            container.appendChild(card);
        });
        
        // 绑定复选框事件，更新选择计数
        const checkboxes = document.querySelectorAll('input[type="checkbox"][id^="data-"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedCount);
        });
        
        // 更新选择计数
        updateSelectedCount();
    }
    
    // 更新选择计数
    function updateSelectedCount() {
        const checkedBoxes = document.querySelectorAll('input[type="checkbox"][id^="data-"]:checked');
        const selectedCount = checkedBoxes.length;
        document.getElementById('selected-count').textContent = `已选择: ${selectedCount}`;
        
        // 更新保存按钮状态
        const saveButton = document.getElementById('save-selected');
        saveButton.disabled = selectedCount === 0;
    }
    
    // 选择可见数据
    function selectVisibleData() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"][id^="data-"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = true;
        });
        updateSelectedCount();
    }
    
    // 清除选择
    function clearSelectedData() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"][id^="data-"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = false;
        });
        updateSelectedCount();
    }
    
    // 保存选中的数据
    function saveSelectedData() {
        const checkedBoxes = document.querySelectorAll('input[type="checkbox"][id^="data-"]:checked');
        const selectedIds = Array.from(checkedBoxes).map(cb => cb.value);
        
        if (selectedIds.length === 0) {
            alert('请选择至少一条数据');
            return;
        }
        
        // 显示加载状态
        const saveButton = document.getElementById('save-selected');
        const originalText = saveButton.innerHTML;
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>保存中...</span>';
        saveButton.disabled = true;
        
        // 发送请求保存数据
        fetch('/crawler/collect/save', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'selected_ids': selectedIds
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showSuccessModal(data.message || '已成功保存选中的数据到数据库');
            } else {
                alert(data.message || '保存失败');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('保存失败');
        })
        .finally(() => {
            saveButton.innerHTML = originalText;
            updateSelectedCount();
        });
    }
    
    // 显示成功弹窗
    function showSuccessModal(message) {
        const modal = document.getElementById('save-success-modal');
        const modalContent = document.getElementById('modal-content');
        const messageElement = document.getElementById('save-success-message');
        
        messageElement.textContent = message;
        modal.classList.remove('hidden');
        
        // 添加动画效果
        setTimeout(() => {
            modalContent.classList.remove('scale-95', 'opacity-0');
            modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);
    }
    
    // 关闭弹窗
    function closeModal() {
        const modal = document.getElementById('save-success-modal');
        const modalContent = document.getElementById('modal-content');
        
        // 添加关闭动画效果
        modalContent.classList.remove('scale-100', 'opacity-100');
        modalContent.classList.add('scale-95', 'opacity-0');
        
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }
    
    // 自动滚动到最新位置
    function autoScrollToBottom() {
        const container = document.getElementById('collection-results');
        if (container) {
            const currentScrollTop = container.scrollTop;
            const scrollHeight = container.scrollHeight;
            const clientHeight = container.clientHeight;
            
            // 如果用户没有手动滚动，或者已经滚动到底部附近，则自动滚动
            if (currentScrollTop + clientHeight >= scrollHeight - 100) {
                container.scrollTop = scrollHeight;
            }
        }
    }
}
</script>
<!-- [/JSMOD] j0k_侧边栏交互 -- 处理侧边栏的显示和隐藏，以及图表的初始化和响应式处理 -->
</body>
</html>
